import{d as je,Q as Ne,z as s,R as Ae,S as X,C as we,E as le,U as Qe,x as Fe}from"./index-d78fa6c6.js";const Pe={},Oe=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),ke=()=>Pe;je({name:"RequestConfig",props:{config:{type:Object,required:!0}},setup(e,{slots:n}){const{config:t}=e;return Ne(Oe,t),()=>{var r;return(r=n.default)===null||r===void 0?void 0:r.call(n)}}});const We=Object.prototype.toString,be=e=>We.call(e),De=e=>be(e)==="[object String]",qe=e=>be(e)==="[object Object]",me=e=>e!==null&&typeof e=="object",xe=e=>me(e)&&ue(e.then)&&ue(e.catch),ue=e=>e instanceof Function,ie=e=>e==null,ge=typeof window>"u",ve=()=>{var e,n;return!ge&&((e=window)===null||e===void 0||(n=e.document)===null||n===void 0?void 0:n.visibilityState)==="visible"},ye=()=>{var e,n,t;return(e=!ge&&((n=window)===null||n===void 0||(t=n.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},Ke=e=>{const n={};return Object.keys(e).forEach(t=>{n[t]=Fe(e[t])}),n},Z=Promise.resolve(null),pe=async(...e)=>{const n=await fetch(...e);if(n.ok)return n.json();throw new Error(n.statusText)};function Ue(e,n){const t=Object.assign({},e);for(const r of n)delete t[r];return t}const Be=(e,n=!1)=>{const t=`Warning: [vue-request] ${e}`;if(n)return new Error(t);console.error(t)},Me=(e,n)=>{let t=!1;return(...r)=>{t||(t=!0,e(...r),setTimeout(()=>{t=!1},n))}};var ce;const Re=new Set,Ie=new Set,_e=new Set,re=(e,n)=>{let t;switch(e){case"FOCUS_LISTENER":t=Re;break;case"RECONNECT_LISTENER":t=_e;break;case"VISIBLE_LISTENER":t=Ie;break}if(!t.has(n))return t.add(n),()=>{t.delete(n)}},de=e=>{e.forEach(n=>{n()})};!ge&&(ce=window)!==null&&ce!==void 0&&ce.addEventListener&&(window.addEventListener("visibilitychange",()=>{ve()&&de(Ie)},!1),window.addEventListener("focus",()=>de(Re),!1),window.addEventListener("online",()=>de(_e),!1));function Le(e,n,t){let r,l,E,f,d,v,T=0,P=!1,C=!1,N=!0;const U=!n&&n!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");n=+n||0,me(t)&&(P=!!t.leading,C="maxWait"in t,E=C?Math.max(+t.maxWait||0,n):E,N="trailing"in t?!!t.trailing:N);function R(a){const u=r,m=l;return r=l=void 0,T=a,f=e.apply(m,u),f}function I(a,u){return U?(window.cancelAnimationFrame(d),window.requestAnimationFrame(a)):setTimeout(a,u)}function k(a){if(U)return window.cancelAnimationFrame(a);clearTimeout(a)}function p(a){return T=a,d=I(_,n),P?R(a):f}function W(a){const u=a-v,m=a-T,y=n-u;return C?Math.min(y,E-m):y}function B(a){const u=a-v,m=a-T;return v===void 0||u>=n||u<0||C&&m>=E}function _(){const a=Date.now();if(B(a))return G(a);d=I(_,W(a))}function G(a){return d=void 0,N&&r?R(a):(r=l=void 0,f)}function S(){d!==void 0&&k(d),T=0,r=v=l=d=void 0}function D(){return d===void 0?f:G(Date.now())}function q(){return d!==void 0}function w(...a){const u=Date.now(),m=B(u);if(r=a,l=this,v=u,m){if(d===void 0)return p(v);if(C)return d=I(_,n),R(v)}return d===void 0&&(d=I(_,n)),f}return w.cancel=S,w.flush=D,w.pending=q,w}function Ve(e,n,t){let r=!0,l=!0;if(typeof e!="function")throw new TypeError("Expected a function");return me(t)&&(r="leading"in t?!!t.leading:r,l="trailing"in t?!!t.trailing:l),Le(e,n,{leading:r,trailing:l,maxWait:n})}const He=(e,n)=>t=>{Object.keys(t).forEach(r=>{e[r].value=t[r]}),n.forEach(r=>r(e))},oe=(e,n,t)=>{var r,l,E;const{initialAutoRunFlag:f,initialData:d,loadingDelay:v,pollingInterval:T,debounceInterval:P,debounceOptions:C,throttleInterval:N,throttleOptions:U,pollingWhenHidden:R,pollingWhenOffline:I,errorRetryCount:k,errorRetryInterval:p,stopPollingWhenHiddenOrOffline:W,refreshOnWindowFocus:B,refocusTimespan:_,updateCache:G,formatResult:S,onSuccess:D,onError:q,onBefore:w,onAfter:a}=n,u=s(0),m=s((r=t?.loading)!==null&&r!==void 0?r:!1),y=s((l=t?.data)!==null&&l!==void 0?l:d),A=s(t?.error),x=s((E=t?.params)!==null&&E!==void 0?E:[]),j=He({loading:m,data:y,error:A,params:x},[i=>G(i)]),M=()=>{u.value=0},Q=s(0),V=s(),$=s(),H=s(),ee=()=>{V.value&&V.value(),H.value&&H.value(),$.value&&$.value()},z=()=>{let i;return v&&(i=setTimeout(j,v,{loading:!0})),()=>i&&clearTimeout(i)},ne=i=>{if(A.value&&k!==0)return;let g;if(!ie(T)&&T>=0)if((R||ve())&&(I||ye()))g=setTimeout(i,T);else{W.value=!0;return}return()=>g&&clearTimeout(g)},o=we(()=>{if(p)return p;const i=1e3,g=1,b=9,K=Math.floor(Math.random()*2**Math.min(u.value,b)+g);return i*K}),h=i=>{let g;const b=k===-1,K=u.value<k;return A.value&&(b||K)&&(b||(u.value+=1),g=setTimeout(i,o.value)),()=>g&&clearTimeout(g)},c=(...i)=>{j({loading:!v,params:i}),H.value=z(),Q.value+=1;const g=Q.value;return w?.(i),e(...i).then(b=>{if(g===Q.value){const K=S?S(b):b;return j({data:K,loading:!1,error:void 0}),D&&D(K,i),M(),K}return Z}).catch(b=>(g===Q.value&&(j({data:void 0,loading:!1,error:b}),q&&q(b,i),console.error(b)),Z)).finally(()=>{g===Q.value&&(H.value(),$.value=h(()=>c(...i)),V.value=ne(()=>c(...i)),a?.(i))})},L=!ie(P)&&Le(c,P,C),O=!ie(N)&&Ve(c,N,U),F=(...i)=>(ee(),!f.value&&L?(L(...i),Z):O?(O(...i),Z):(M(),c(...i))),J=()=>{Q.value+=1,j({loading:!1}),L&&L.cancel(),O&&O.cancel(),ee()},se=()=>F(...x.value),Se=i=>{const g=ue(i)?i(y.value):i;j({data:g})},he=[],te=i=>{i&&he.push(i)},Ee=()=>{W.value&&(R||ve())&&(I||ye())&&(se(),W.value=!1)};R||te(re("VISIBLE_LISTENER",Ee)),I||te(re("RECONNECT_LISTENER",Ee));const Te=Me(se,_);return B&&(te(re("VISIBLE_LISTENER",Te)),te(re("FOCUS_LISTENER",Te))),{loading:m,data:y,error:A,params:x,run:F,cancel:J,refresh:se,mutate:Se,unmount:()=>{he.forEach(i=>i())}}},ae=new Map,fe=e=>{if(ie(e))return;const n=ae.get(e);if(!!n)return{data:n.data,cacheTime:n.cacheTime}},Ye=(e,n,t)=>{const r=ae.get(e);r!=null&&r.timer&&clearTimeout(r.timer);const l=setTimeout(()=>ae.delete(e),t);ae.set(e,{data:n,timer:l,cacheTime:new Date().getTime()})},Y="__QUERY_DEFAULT_KEY__";function Ge(e,n){const t=Ae(Oe,{}),{cacheKey:r,defaultParams:l=[],manual:E=!1,ready:f=s(!0),refreshDeps:d=[],loadingDelay:v=0,pollingWhenHidden:T=!1,pollingWhenOffline:P=!1,refreshOnWindowFocus:C=!1,refocusTimespan:N=5e3,cacheTime:U=6e5,staleTime:R=0,errorRetryCount:I=0,errorRetryInterval:k=0,queryKey:p,...W}={...ke(),...t,...n},B=s(!1),_=s(!1),S={initialAutoRunFlag:_,loadingDelay:v,pollingWhenHidden:T,pollingWhenOffline:P,stopPollingWhenHiddenOrOffline:B,cacheKey:r,errorRetryCount:I,errorRetryInterval:k,refreshOnWindowFocus:C,refocusTimespan:N,updateCache:o=>{var h,c;if(!r)return;const L=(h=fe(r))===null||h===void 0?void 0:h.data,O=L?.queries,F=Ke(o),J=(c=p?.(...o.params.value))!==null&&c!==void 0?c:Y;Ye(r,{queries:{...O,[J]:{...O?.[J],...F}},latestQueriesKey:J},U)},...Ue(W,["pagination","listKey"])},D=s(!1),q=s(),w=s(),a=s(),u=X({[Y]:X(oe(e,S))}),m=s(Y),y=we(()=>{var o;return(o=u[m.value])!==null&&o!==void 0?o:{}});if(le(y,o=>{D.value=o.loading,q.value=o.data,w.value=o.error,a.value=o.params},{immediate:!0,deep:!0}),r){var A;const o=fe(r);o!=null&&(A=o.data)!==null&&A!==void 0&&A.queries&&(Object.keys(o.data.queries).forEach(h=>{const c=o.data.queries[h];u[h]=X(oe(e,S,{loading:c.loading,params:c.params,data:c.data,error:c.error}))}),o.data.latestQueriesKey&&(m.value=o.data.latestQueriesKey))}const x=s(),j=s(!1),M=(...o)=>{var h;if(!f.value&&!j.value)return x.value=o,Z;const c=(h=p?.(...o))!==null&&h!==void 0?h:Y;return u[c]||(u[c]=X(oe(e,S))),m.value=c,y.value.run(...o)},Q=()=>{V(),m.value=Y,u[Y]=X(oe(e,S))},V=()=>{Object.keys(u).forEach(o=>{u[o].cancel(),u[o].unmount(),delete u[o]})},$=()=>y.value.cancel(),H=()=>y.value.refresh(),ee=o=>y.value.mutate(o);if(!E){var z;_.value=!0;const o=fe(r),h=(z=o?.data.queries)!==null&&z!==void 0?z:{},c=o&&(R===-1||o.cacheTime+R>new Date().getTime()),L=Object.keys(h).length>0;c||(L?Object.keys(u).forEach(O=>{var F;(F=u[O])===null||F===void 0||F.refresh()}):M(...l)),_.value=!1}const ne=s();return ne.value=le(f,o=>{j.value=!0,o&&x.value&&(M(...x.value),ne.value())},{flush:"sync"}),d.length&&le(d,()=>{!E&&y.value.refresh()}),Qe(()=>{V()}),{loading:D,data:q,error:w,params:a,cancel:$,refresh:H,mutate:ee,run:M,reset:Q,queries:u}}const Ce=e=>(...n)=>{if(ue(e))return Ce(e(...n))();if(xe(e))return e;if(qe(e)){const{url:t,...r}=e;return pe(t,r)}else{if(De(e))return pe(e);throw Be("Unknown service type",!0)}};function Je(e,n){const t=Ce(e),{reset:r,run:l,...E}=Ge(t,n??{}),f=s(!1);return{reload:async()=>{const{defaultParams:v=[],manual:T}=n;r(),T||(f.value=!0,await l(...v),f.value=!1)},run:l,reloading:f,...E}}export{Je as u};
